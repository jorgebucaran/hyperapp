{"version":3,"file":"hyperapp.js","sources":["../src/h.js","../src/app.js","../src/router.js"],"sourcesContent":["export default function (tag, data) {\n\tdata = data || {}\n\n\tvar children = []\n\tchildren.push.apply(children, arguments)\n\tchildren.shift()\n\tchildren.shift()\n\tvar head = children[0]\n\n\tchildren = Array.isArray(head) || head === undefined ? head : children\n\n\tif (typeof tag === \"function\") {\n\t\tdata.children = children || []\n\t\treturn tag(data)\n\t}\n\n\tif (tag === \"svg\") {\n\t\tsvg(tag, data, children)\n\t}\n\n\treturn {\n\t\ttag: tag,\n\t\tdata: data,\n\t\tchildren: [].concat.apply([], children)\n\t}\n}\n\nfunction svg(tag, data, children) {\n\tdata.ns = \"http://www.w3.org/2000/svg\"\n\n\tfor (var i = 0; i < children.length; i++) {\n\t\tvar node = children[i]\n\t\tif (node.data) {\n\t\t\tsvg(node.tag, node.data, node.children)\n\t\t}\n\t}\n}\n","export default function (options) {\n\tvar model = options.model\n\tvar view = options.view\n\n\tvar actions = {}\n\tvar effects = options.effects || {}\n\tvar reducers = options.update || {}\n\n\tvar subs = options.subscriptions\n\n\tvar router = options.router || Function.prototype\n\n\tvar node\n\tvar root\n\n\tvar hooks = merge({\n\t\t// onRoute?\n\t\tonAction: Function.prototype,\n\t\tonUpdate: Function.prototype,\n\t\tonError: function (err) {\n\t\t\tthrow err\n\t\t}\n\t}, options.hooks)\n\n\tfor (var name in merge(reducers, effects)) {\n\t\t(function (name) {\n\t\t\tactions[name] = function (data) {\n\t\t\t\thooks.onAction(name, data)\n\n\t\t\t\tvar effect = effects[name]\n\t\t\t\tif (effect) {\n\t\t\t\t\treturn effect(model, actions, data, hooks.onError)\n\t\t\t\t}\n\n\t\t\t\tvar update = reducers[name], _model = model\n\t\t\t\trender(model = merge(model, update(model, data)), view, node)\n\n\t\t\t\thooks.onUpdate(_model, model, data)\n\t\t\t}\n\t\t}(name))\n\t}\n\n\tready(function () {\n\t\troot = options.root || document.body.appendChild(document.createElement(\"div\"))\n\n\t\tif (typeof view === \"function\") {\n\t\t\trender(model, view)\n\t\t}\n\n\t\trouter(merge(options, {\n\t\t\trender: function (newView) {\n\t\t\t\trender(model, view = newView ? newView : view, node)\n\t\t\t}\n\t\t}))\n\n\t\tfor (var key in subs) {\n\t\t\tsubs[key](model, actions, hooks.onError)\n\t\t}\n\t})\n\n\tfunction ready(cb) {\n\t\tif (document.readyState !== \"loading\") {\n\t\t\tcb()\n\t\t} else {\n\t\t\tdocument.addEventListener(\"DOMContentLoaded\", cb)\n\t\t}\n\t}\n\n\tfunction render(model, view, lastNode) {\n\t\tpatch(root, node = view(model, actions), lastNode, 0)\n\t}\n\n\tfunction merge(a, b) {\n\t\tvar obj = {}, key\n\n\t\tif (isPrimitive(typeof b) || Array.isArray(b)) {\n\t\t\treturn b\n\t\t}\n\n\t\tfor (key in a) {\n\t\t\tobj[key] = a[key]\n\t\t}\n\t\tfor (key in b) {\n\t\t\tobj[key] = b[key]\n\t\t}\n\n\t\treturn obj\n\t}\n\n\tfunction isPrimitive(type) {\n\t\treturn type === \"string\" || type === \"number\" || type === \"boolean\"\n\t}\n\n\tfunction defer(fn, data) {\n\t\tsetTimeout(function () {\n\t\t\tfn(data)\n\t\t}, 0)\n\t}\n\n\tfunction shouldUpdate(a, b) {\n\t\treturn a.tag !== b.tag\n\t\t\t|| typeof a !== typeof b\n\t\t\t|| isPrimitive(typeof a) && a !== b\n\t}\n\n\tfunction createElementFrom(node) {\n\t\tvar element\n\t\tif (isPrimitive(typeof node)) {\n\t\t\telement = document.createTextNode(node)\n\n\t\t} else {\n\t\t\telement = node.data && node.data.ns\n\t\t\t\t? document.createElementNS(node.data.ns, node.tag)\n\t\t\t\t: document.createElement(node.tag)\n\n\t\t\tfor (var name in node.data) {\n\t\t\t\tif (name === \"oncreate\") {\n\t\t\t\t\tdefer(node.data[name], element)\n\t\t\t\t} else {\n\t\t\t\t\tsetElementData(element, name, node.data[name])\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < node.children.length; i++) {\n\t\t\t\telement.appendChild(createElementFrom(node.children[i]))\n\t\t\t}\n\t\t}\n\n\t\treturn element\n\t}\n\n\tfunction removeElementData(element, name, value) {\n\t\telement.removeAttribute(name === \"className\" ? \"class\" : name)\n\n\t\tif (typeof value === \"boolean\" || value === \"true\" || value === \"false\") {\n\t\t\telement[name] = false\n\t\t}\n\t}\n\n\tfunction setElementData(element, name, value, oldValue) {\n\t\tif (name === \"style\") {\n\t\t\tfor (var i in value) {\n\t\t\t\telement.style[i] = value[i]\n\t\t\t}\n\n\t\t} else if (name.substr(0, 2) === \"on\") {\n\t\t\tvar event = name.substr(2).toLowerCase()\n\t\t\telement.removeEventListener(event, oldValue)\n\t\t\telement.addEventListener(event, value)\n\n\t\t} else {\n\t\t\tif (value === \"false\" || value === false) {\n\t\t\t\telement.removeAttribute(name)\n\t\t\t\telement[name] = false\n\t\t\t} else {\n\t\t\t\telement.setAttribute(name, value)\n\t\t\t\telement[name] = value\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction updateElementData(element, data, oldData) {\n\t\tfor (var name in merge(oldData, data)) {\n\t\t\tvar value = data[name], oldValue = oldData[name]\n\n\t\t\tif (value === undefined) {\n\t\t\t\tremoveElementData(element, name, oldValue)\n\n\t\t\t} else if (value !== oldValue) {\n\t\t\t\tname === \"onupdate\"\n\t\t\t\t\t? defer(value, element)\n\t\t\t\t\t: setElementData(element, name, value, oldValue)\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction patch(parent, node, oldNode, index) {\n\t\tif (oldNode === undefined) {\n\t\t\tparent.appendChild(createElementFrom(node))\n\n\t\t} else if (node === undefined) {\n\t\t\twhile (index > 0 && !parent.childNodes[index]) {\n\t\t\t\tindex--\n\t\t\t}\n\n\t\t\tvar element = parent.childNodes[index]\n\n\t\t\tif (oldNode && oldNode.data) {\n\t\t\t\tvar hook = oldNode.data.onremove\n\t\t\t\tif (hook) {\n\t\t\t\t\tdefer(hook, element)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tparent.removeChild(element)\n\n\t\t} else if (shouldUpdate(node, oldNode)) {\n\t\t\tparent.replaceChild(createElementFrom(node), parent.childNodes[index])\n\n\t\t} else if (node.tag) {\n\t\t\tvar element = parent.childNodes[index]\n\n\t\t\tupdateElementData(element, node.data, oldNode.data)\n\n\t\t\tvar len = node.children.length, oldLen = oldNode.children.length\n\n\t\t\tfor (var i = 0; i < len || i < oldLen; i++) {\n\t\t\t\tpatch(element, node.children[i], oldNode.children[i], i)\n\t\t\t}\n\t\t}\n\t}\n}\n","export default function (options) {\n    var routes = options.view\n    var render = options.render\n\n    function setLocation(data) {\n        render(match(routes, data))\n        history.pushState({}, \"\", data)\n    }\n\n    window.addEventListener(\"popstate\", function () {\n        render(match(routes, location.pathname))\n    })\n\n    window.addEventListener(\"click\", function (e) {\n        if (e.metaKey || e.shiftKey || e.ctrlKey || e.altKey) {\n            return\n        }\n\n        var target = e.target\n\n        while (target && target.localName !== \"a\") {\n            target = target.parentNode\n        }\n\n        if (target && target.host === location.host\n            && !target.hasAttribute(\"data-no-routing\")) {\n\n            var element = document.querySelector(target.hash === \"\" ? element : target.hash)\n\n            if (element) {\n                element.scrollIntoView(true)\n            } else {\n                e.preventDefault()\n                setLocation(target.pathname)\n            }\n        }\n    })\n\n    render(match(routes, location.pathname))\n\n    function match(routes, path) {\n        for (var route in routes) {\n            var re = regexify(route), params = {}, match\n\n            path.replace(new RegExp(re.re, \"g\"), function () {\n                for (var i = 1; i < arguments.length - 2; i++) {\n                    params[re.keys.shift()] = arguments[i]\n                }\n\n                match = function (model, actions) {\n                    actions.setLocation = setLocation\n                    return routes[route](model, actions, params)\n                }\n            })\n\n            if (match) {\n                return match\n            }\n        }\n\n        return routes[\"/\"]\n    }\n\n    function regexify(path) {\n        var keys = [], re = \"^\" + path\n            .replace(/\\//g, \"\\\\/\")\n            .replace(/:([A-Za-z0-9_]+)/g, function (_, key) {\n                keys.push(key)\n                return \"([A-Za-z0-9_]+)\"\n            }) + \"/?$\"\n\n        return { re: re, keys: keys }\n    }\n}\n"],"names":["svg","tag","data","children","ns","i","length","node","push","apply","arguments","shift","head","Array","isArray","undefined","concat","options","ready","cb","document","readyState","addEventListener","render","model","view","lastNode","patch","root","actions","merge","a","b","key","obj","isPrimitive","type","defer","fn","setTimeout","shouldUpdate","createElementFrom","element","createTextNode","createElementNS","createElement","name","setElementData","appendChild","removeElementData","value","removeAttribute","oldValue","style","substr","event","toLowerCase","removeEventListener","setAttribute","updateElementData","oldData","parent","oldNode","index","childNodes","hook","onremove","removeChild","replaceChild","len","oldLen","effects","reducers","update","subs","subscriptions","router","Function","prototype","hooks","onAction","onUpdate","onError","err","effect","_model","body","newView","setLocation","match","routes","history","pushState","path","route","re","regexify","params","replace","RegExp","keys","_","window","location","pathname","e","metaKey","shiftKey","ctrlKey","altKey","target","localName","parentNode","host","hasAttribute","querySelector","hash","scrollIntoView","preventDefault"],"mappings":"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"}